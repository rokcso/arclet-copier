# 🌈 Arclet Copier

快速复制当前页面 URL 的 Chrome 扩展程序，支持参数过滤和 Markdown 链接格式。

## 功能特色

- 🔗 **一键复制 URL**：支持 popup 点击和快捷键静默复制
- 🔧 **智能参数清理**：三级清理模式（关闭/智能清理/清除所有参数），智能模式仅移除跟踪参数
- 📝 **Markdown 格式**：支持复制为 `[标题](URL)` 格式的 Markdown 链接
- 📱 **二维码生成**：为当前页面URL生成二维码，支持主题自适应
- 🌙 **深色主题**：完整的深色主题支持，可跟随系统或手动切换
- ⚡ **快捷键支持**：`Ctrl+Shift+C` (Windows/Linux) 或 `Cmd+Shift+C` (Mac)
- 🌍 **多语言支持**：简体中文和英文界面，支持动态切换
- 🛡️ **智能处理**：针对 Chrome 系统页面优化，提供友好的用户体验
- 🏗️ **模块化架构**：采用现代ES6模块化设计，代码结构清晰，易于维护和扩展

## 安装方法

### 方法一：直接下载安装

1. **下载扩展程序**
   - 点击右侧 [Releases](../../releases) 页面
   - 下载最新版本的 `arclet-copier.zip` 文件
   - 解压到本地文件夹

2. **Chrome 浏览器安装**
   - 打开 Chrome 浏览器
   - 地址栏输入 `chrome://extensions/`
   - 开启右上角的"开发者模式"
   - 点击"加载已解压的扩展程序"
   - 选择解压后的文件夹

### 方法二：从源码安装

1. **克隆仓库**
   ```bash
   git clone https://github.com/rokcso/arclet-copier.git
   cd arclet-copier
   ```

2. **Chrome 浏览器安装**
   - 打开 Chrome 浏览器
   - 地址栏输入 `chrome://extensions/`
   - 开启右上角的"开发者模式"
   - 点击"加载已解压的扩展程序"
   - 选择项目文件夹

## 使用说明

### Popup 界面操作

1. 点击工具栏中的扩展图标
2. 在弹出界面中：
   - **复制 URL**：复制当前页面链接
   - **复制为 Markdown**：复制为 `[页面标题](URL)` 格式
   - **生成二维码**：为当前页面URL生成二维码，支持主题自适应
   - **URL清理**：三段滑块控制（关闭/智能清理/清除所有参数）
   - **静默复制格式**：设置快捷键复制的默认格式
   - **外观**：三段滑块控制（跟随系统/浅色模式/深色模式）
   - **语言设置**：在简体中文和英文之间切换界面语言

### 快捷键操作

- **Windows/Linux**：`Ctrl + Shift + C`
- **Mac**：`Cmd + Shift + C`

快捷键会根据设置中的"静默复制格式"来复制 URL 或 Markdown 链接。

### 特殊页面说明

在 Chrome 系统页面（如 `chrome://extensions/`）使用时：
- **Popup 操作**：正常工作，可以复制链接
- **快捷键操作**：会提示"当前页面为系统页面，请点击扩展图标使用复制功能"

### 项目结构

采用**按功能分割的模块化架构**，便于开发和维护：

```
arclet-copier/
├── manifest.json              # 扩展程序配置文件
├── background/                 # 后台服务功能模块
│   └── background.js          #   Service Worker，处理快捷键和核心逻辑
├── popup/                      # 弹窗界面功能模块
│   ├── popup.html             #   弹窗HTML结构
│   ├── popup.js               #   用户交互逻辑
│   └── popup.css              #   界面样式
├── offscreen/                  # 剪贴板操作功能模块
│   ├── offscreen.html         #   Offscreen文档
│   └── offscreen.js           #   剪贴板操作逻辑
├── shared/                     # 共享资源和工具模块
│   ├── constants.js           #   共享常量和工具函数
│   └── lib/                   #   第三方库
│       └── qrcode.min.js      #     二维码生成库
├── assets/                     # 静态资源
│   └── icons/                 #   扩展程序图标
│       ├── icon16.png
│       ├── icon32.png
│       ├── icon48.png
│       ├── icon64.png
│       ├── icon128.png
│       └── icon256.png
├── _locales/                   # 国际化文件
│   ├── en/
│   │   └── messages.json      #   英文语言包
│   └── zh_CN/
│       └── messages.json      #   中文语言包
├── scripts/                    # 构建和工具脚本
│   └── build.js               #   构建脚本
├── TESTING.md                  # 完整测试用例文档
└── package.json               # 项目配置
```

### 构建和打包

如果你想从源码构建：

```bash
# 克隆项目
git clone https://github.com/rokcso/arclet-copier.git
cd arclet-copier

# 运行打包脚本
npm run build
```

构建完成后，打包文件将生成在 `scripts/dist/arclet-copier-v{version}/` 目录中。

### 本地开发

#### 开发流程
1. 克隆仓库并进入项目目录
2. 直接在项目根目录加载扩展（无需构建）
3. 修改代码后，在 `chrome://extensions/` 页面点击扩展程序的"重新加载"按钮
4. 测试功能是否正常工作

#### 模块化开发说明
- **background/**: 后台逻辑，支持ES6模块导入
- **popup/**: 前端界面，使用`type="module"`支持模块化
- **shared/**: 共享工具函数，避免代码重复
- **offscreen/**: 独立的剪贴板操作模块

#### 测试
项目提供完整的测试用例文档，请参考 [TESTING.md](TESTING.md) 进行系统性测试。

## 权限说明

此扩展程序需要以下权限：

- `activeTab`：获取当前标签页信息（URL、标题）
- `storage`：保存用户设置
- `notifications`：显示复制成功通知
- `scripting`：在网页中注入复制脚本

所有权限仅用于复制功能，不会收集或上传任何用户数据。

## 问题反馈

如果遇到问题或有功能建议，请在 [Issues](../../issues) 页面提交反馈。

## 许可证

MIT License - 详见 [LICENSE](LICENSE) 文件

## 更新日志

### v1.3.2
- 🏗️ **代码架构重构**: 采用按功能分割的模块化架构，提升代码可维护性和可扩展性
- 📦 **ES6模块化**: 全面支持ES6模块导入导出，减少代码重复
- 🔧 **构建系统优化**: 更新构建脚本适配新的目录结构
- 🧪 **测试体系完善**: 新增完整的测试用例文档(TESTING.md)，包含100+个测试用例
- 🐛 **通知系统修复**: 修复通知图标加载问题，确保通知正常显示

### v1.3.1
- 🐛 **重要Bug修复**: 解决静默复制（快捷键）不尊重URL参数清理设置的关键问题

### v1.3.0
- 📱 **二维码生成**: 新增二维码生成功能，可以为当前页面URL生成二维码，支持主题适配
- 🌙 **深色主题支持**: 完整的深色主题适配，支持系统主题自动检测和手动切换
- 🧠 **智能URL清理**: 升级URL参数清理功能，新增智能模式（仅移除跟踪参数，保留功能参数）
- 🎛️ **自适应三段滑块**: 实现全新的自适应滑块组件，支持根据文案长度自动调整宽度
- 🎨 **外观设置滑块**: 将外观设置改为三段滑块形式（跟随系统/浅色模式/深色模式），替代下拉菜单
- ✨ **动画优化**: 改进通知动画效果，采用缩放动画替代滑动效果，体验更流畅

### v1.2.0
- 🌍 **国际化支持**: 新增简体中文和英文双语支持，支持动态语言切换
- 🎨 **界面优化**: 重新设计界面布局，添加开发者信息和版本显示
- 🔔 **通知增强**: 为所有设置项添加保存成功通知，提升用户反馈体验

### v1.1.0
- 🔧 **修复新标签页静默复制问题**: 解决了在新打开的标签页中使用快捷键复制失败的问题
- 🚀 **采用 Offscreen API**: 使用 Chrome 扩展 Manifest V3 推荐的 Offscreen Documents 替代内容脚本注入
- ⚡ **提升兼容性**: 不再依赖 `activeTab` 权限激活，支持在任何页面状态下进行静默复制
- 🛡️ **增强稳定性**: 绕过页面 CSP 限制和加载状态影响，在独立扩展环境中执行复制操作
- 📝 **权限优化**: 添加 `clipboardWrite` 权限，符合最新的浏览器安全要求

### v1.0.0
- 基础 URL 复制功能
- 支持参数过滤
- 支持 Markdown 格式复制
- 快捷键支持
- Chrome 系统页面优化
