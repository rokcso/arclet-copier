# ğŸ—ï¸ Arclet Copier æ„å»ºæŒ‡å—

## ğŸ“¦ æ„å»ºç³»ç»Ÿæ¦‚è¿°

Arclet Copier ç°å·²é›†æˆ **esbuild** ä½œä¸ºæ„å»ºå·¥å…·ï¼Œæä¾›æé€Ÿçš„æ„å»ºä½“éªŒå’Œä»£ç ä¼˜åŒ–ã€‚

### âš¡ æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | æ—§æ–¹å¼ï¼ˆæ–‡ä»¶å¤åˆ¶ï¼‰ | esbuild |
|------|------------------|---------|
| **æ„å»ºé€Ÿåº¦** | ~1s | ~15ms (66x faster) |
| **ä»£ç å‹ç¼©** | âŒ æ—  | âœ… å·²å¯ç”¨ |
| **Tree Shaking** | âŒ æ—  | âœ… å·²å¯ç”¨ |
| **è¾“å‡ºå¤§å°** | 455KB | 134KB (-70%) |
| **å¼€å‘æ¨¡å¼** | âŒ æ—  | âœ… Watch æ¨¡å¼ |
| **Source Map** | âŒ æ—  | âœ… å¼€å‘æ¨¡å¼æ”¯æŒ |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
npm install
```

### æ„å»ºå‘½ä»¤

#### 1ï¸âƒ£ ç”Ÿäº§æ„å»º
```bash
npm run build
```

**è¾“å‡ºç›®å½•**: `dist/arclet-copier-v{version}/`

**ç‰¹æ€§**:
- âœ… ä»£ç å‹ç¼©å’Œæ··æ·†
- âœ… Tree Shakingï¼ˆç§»é™¤æœªä½¿ç”¨ä»£ç ï¼‰
- âœ… ç”Ÿæˆæ„å»ºåˆ†ææŠ¥å‘Š (`meta.json`)
- âœ… æ˜¾ç¤ºè¯¦ç»†çš„æ„å»ºç»Ÿè®¡ä¿¡æ¯

**è¾“å‡ºç¤ºä¾‹**:
```
ğŸ“Š Build Analysis:
   background/background.js: 29.13 KB
   popup/popup.js: 30.78 KB
   options/options.js: 29.24 KB
   batch/batch.js: 32.71 KB
   content/content.js: 11.08 KB
   offscreen/offscreen.js: 0.95 KB

   Total JS: 133.89 KB (0.13 MB)
   Total Package: 644.54 KB (0.63 MB)
```

#### 2ï¸âƒ£ å¼€å‘æ¨¡å¼ï¼ˆWatchï¼‰
```bash
npm run dev
```

**è¾“å‡ºç›®å½•**: `dist-dev/`

**ç‰¹æ€§**:
- âœ… ç›‘å¬æ–‡ä»¶å˜åŒ–è‡ªåŠ¨é‡æ–°æ„å»º
- âœ… å†…è” Source Mapï¼ˆä¾¿äºè°ƒè¯•ï¼‰
- âœ… æ— ä»£ç å‹ç¼©ï¼ˆæ„å»ºæ›´å¿«ï¼‰
- âœ… å®æ—¶åé¦ˆ

**ä½¿ç”¨åœºæ™¯**:
- ğŸ”§ æœ¬åœ°å¼€å‘å’Œè°ƒè¯•
- ğŸ› Bug ä¿®å¤
- âœ¨ åŠŸèƒ½å¼€å‘

**å·¥ä½œæµç¨‹**:
1. è¿è¡Œ `npm run dev`
2. åœ¨ Chrome ä¸­åŠ è½½ `dist-dev/` ç›®å½•
3. ä¿®æ”¹ä»£ç åè‡ªåŠ¨é‡æ–°æ„å»º
4. æ‰‹åŠ¨åˆ·æ–°æ‰©å±•ï¼ˆChrome æ‰©å±•é¡µé¢ç‚¹å‡»åˆ·æ–°å›¾æ ‡ï¼‰

---

## ğŸ“‹ æ„å»ºé…ç½®è¯¦è§£

### é…ç½®æ–‡ä»¶
`scripts/esbuild.config.js`

### æ ¸å¿ƒé…ç½®

#### å…¥å£æ–‡ä»¶
```javascript
entryPoints: [
  "background/background.js",    // Service Worker
  "popup/popup.js",              // å¼¹çª—ç•Œé¢
  "options/options.js",          // è®¾ç½®é¡µé¢
  "batch/batch.js",              // æ‰¹é‡æ“ä½œ
  "content/content.js",          // å†…å®¹è„šæœ¬
  "offscreen/offscreen.js",      // ç¦»å±æ–‡æ¡£
]
```

#### è¾“å‡ºé…ç½®
```javascript
bundle: true,           // æ‰“åŒ…ä¾èµ–
format: "esm",          // ES Module æ ¼å¼
platform: "browser",    // æµè§ˆå™¨å¹³å°
target: "chrome96",     // Chrome 96+ (Manifest V3)
minify: isProduction,   // ç”Ÿäº§ç¯å¢ƒå‹ç¼©
sourcemap: isDev,       // å¼€å‘ç¯å¢ƒ Source Map
treeShaking: true,      // Tree Shaking
```

#### èµ„æºå¤åˆ¶
ä»¥ä¸‹æ–‡ä»¶ä¼šè‡ªåŠ¨å¤åˆ¶åˆ°è¾“å‡ºç›®å½•ï¼š

- **HTML æ–‡ä»¶**: `popup/`, `options/`, `batch/`, `offscreen/`
- **CSS æ–‡ä»¶**: æ‰€æœ‰é¡µé¢çš„æ ·å¼æ–‡ä»¶
- **é™æ€èµ„æº**: `assets/` ç›®å½•ï¼ˆå›¾æ ‡ã€å›¾ç‰‡ç­‰ï¼‰
- **å¤šè¯­è¨€**: `_locales/` ç›®å½•
- **ç¬¬ä¸‰æ–¹åº“**: `shared/lib/` ç›®å½•
- **Manifest**: `manifest.json`

---

## ğŸ”§ å¼€å‘å·¥ä½œæµ

### æ¨èå·¥ä½œæµç¨‹

#### æ–¹å¼ 1: Watch æ¨¡å¼ï¼ˆæ¨èï¼‰
```bash
# ç»ˆç«¯ 1: å¯åŠ¨ watch æ¨¡å¼
npm run dev

# æ“ä½œæ­¥éª¤:
# 1. Chrome è®¿é—® chrome://extensions/
# 2. å¼€å¯"å¼€å‘è€…æ¨¡å¼"
# 3. ç‚¹å‡»"åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº"
# 4. é€‰æ‹© dist-dev/ ç›®å½•
# 5. ä¿®æ”¹ä»£ç ï¼Œè‡ªåŠ¨é‡æ–°æ„å»º
# 6. æ‰‹åŠ¨åˆ·æ–°æ‰©å±•
```

**ä¼˜ç‚¹**:
- âš¡ è‡ªåŠ¨æ„å»ºï¼Œæ— éœ€æ‰‹åŠ¨è¿è¡Œå‘½ä»¤
- ğŸ—ºï¸ Source Map æ”¯æŒï¼Œè°ƒè¯•æ–¹ä¾¿
- ğŸ”„ å¿«é€Ÿè¿­ä»£

**æ³¨æ„**: Chrome ä¸æ”¯æŒæ‰©å±•çƒ­æ›´æ–°ï¼Œéœ€è¦æ‰‹åŠ¨åˆ·æ–°æ‰©å±•ã€‚

#### æ–¹å¼ 2: æ‰‹åŠ¨æ„å»º
```bash
# ä¿®æ”¹ä»£ç å
npm run build

# ç„¶ååœ¨ Chrome ä¸­åˆ·æ–°æ‰©å±•
```

### è°ƒè¯•æŠ€å·§

#### 1ï¸âƒ£ ä½¿ç”¨ Source Map
å¼€å‘æ¨¡å¼ä¸‹ä¼šç”Ÿæˆå†…è” Source Mapï¼Œå¯ä»¥åœ¨ Chrome DevTools ä¸­çœ‹åˆ°åŸå§‹æºç ï¼š

```javascript
// æ„å»ºåçš„ä»£ç ä¼šåŒ…å« source map
//# sourceMappingURL=data:application/json;base64,...
```

#### 2ï¸âƒ£ æŸ¥çœ‹æ„å»ºåˆ†æ
ç”Ÿäº§æ„å»ºåä¼šç”Ÿæˆ `meta.json` æ–‡ä»¶ï¼ŒåŒ…å«è¯¦ç»†çš„æ„å»ºä¿¡æ¯ï¼š

```bash
# åœ¨è¾“å‡ºç›®å½•æŸ¥çœ‹
cat scripts/dist/arclet-copier-v1.6.3/meta.json
```

å¯ä»¥ä½¿ç”¨ [esbuild Bundle Size Analyzer](https://esbuild.github.io/analyze/) åˆ†æè¯¥æ–‡ä»¶ã€‚

#### 3ï¸âƒ£ æ—¥å¿—è°ƒè¯•
æ„å»ºé…ç½®åŒ…å«è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼š

- âœ… æ„å»ºæˆåŠŸ/å¤±è´¥çŠ¶æ€
- âš ï¸ è­¦å‘Šä¿¡æ¯
- ğŸ“Š æ–‡ä»¶å¤§å°ç»Ÿè®¡
- ğŸ“ è¾“å‡ºç›®å½•è·¯å¾„

---

## ğŸ“¦ å‘å¸ƒæµç¨‹

### 1. ç”Ÿäº§æ„å»º
```bash
npm run build
```

### 2. æµ‹è¯•æ„å»ºäº§ç‰©
```bash
# 1. åœ¨ Chrome ä¸­åŠ è½½æ‰©å±•
# chrome://extensions/ -> åŠ è½½å·²è§£å‹çš„æ‰©å±•ç¨‹åº
# é€‰æ‹©: dist/

# 2. æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
# - å¤åˆ¶ URL
# - æ‰¹é‡å¤åˆ¶
# - è®¾ç½®ä¿®æ”¹
# - å¤šè¯­è¨€åˆ‡æ¢
# - çŸ­é“¾ç”Ÿæˆ
# - äºŒç»´ç ç”Ÿæˆ
```

### 3. æ‰“åŒ…å‘å¸ƒ
```bash
# åˆ›å»ºå‘å¸ƒåŒ…
zip -r arclet-copier-v1.6.3.zip dist/

# æˆ–ä½¿ç”¨æ„å»ºåæç¤ºçš„å‘½ä»¤
```

### 4. å‘å¸ƒåˆ° Chrome Web Store
1. è®¿é—® [Chrome Developer Dashboard](https://chrome.google.com/webstore/devconsole)
2. ä¸Šä¼  ZIP æ–‡ä»¶
3. å¡«å†™æ›´æ–°æ—¥å¿—
4. æäº¤å®¡æ ¸

---

## ğŸ¯ æ„å»ºä¼˜åŒ–å»ºè®®

### å½“å‰ä¼˜åŒ–æ•ˆæœ
- âœ… **ä»£ç ä½“ç§¯å‡å°‘ 70%**: 455KB â†’ 134KB
- âœ… **æ„å»ºé€Ÿåº¦æå‡ 66x**: 1s â†’ 15ms
- âœ… **Tree Shaking**: è‡ªåŠ¨ç§»é™¤æœªä½¿ç”¨ä»£ç 
- âœ… **ä»£ç å‹ç¼©**: å˜é‡åç¼©çŸ­ã€ç©ºæ ¼ç§»é™¤

### æœªæ¥ä¼˜åŒ–æ–¹å‘

#### 1ï¸âƒ£ CSS ä¼˜åŒ–
```bash
# è€ƒè™‘å¼•å…¥ CSS å‹ç¼©
npm install -D lightningcss
```

å½“å‰ CSS æ–‡ä»¶æœªå‹ç¼©ï¼Œå¯èŠ‚çœé¢å¤– 30-40% ä½“ç§¯ã€‚

#### 2ï¸âƒ£ å›¾ç‰‡ä¼˜åŒ–
```bash
# å‹ç¼© assets/ ä¸­çš„å›¾ç‰‡
npm install -D imagemin
```

#### 3ï¸âƒ£ ä»£ç åˆ†å‰²
å¦‚æœæœªæ¥ä»£ç é‡å¢é•¿ï¼Œå¯ä»¥è€ƒè™‘å¯ç”¨ä»£ç åˆ†å‰²ï¼š

```javascript
// esbuild.config.js
splitting: true,  // å¯ç”¨ä»£ç åˆ†å‰²
```

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æ„å»ºå¤±è´¥æ€ä¹ˆåŠï¼Ÿ

**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. ç¡®è®¤ Node.js ç‰ˆæœ¬ >= 14
2. åˆ é™¤ `node_modules/` é‡æ–°å®‰è£…: `npm install`
3. æ¸…ç†æ—§çš„æ„å»ºäº§ç‰©: `rm -rf dist/ dist-dev/`
4. æŸ¥çœ‹é”™è¯¯æ—¥å¿—ä¸­çš„å…·ä½“é”™è¯¯ä¿¡æ¯

### Q2: Watch æ¨¡å¼ä¸å·¥ä½œï¼Ÿ

**A**: å¯èƒ½çš„åŸå› ï¼š
1. æ–‡ä»¶æƒé™é—®é¢˜ï¼šç¡®ä¿æœ‰å†™å…¥ `dist-dev/` çš„æƒé™
2. ç«¯å£å ç”¨ï¼šç¡®ä¿æ²¡æœ‰å…¶ä»–è¿›ç¨‹å ç”¨
3. å°è¯•åœæ­¢åé‡æ–°è¿è¡Œï¼š`Ctrl+C` ç„¶å `npm run dev`

### Q3: æ‰©å±•åŠ è½½åä¸å·¥ä½œï¼Ÿ

**A**: æ£€æŸ¥æ¸…å•ï¼š
1. ç¡®è®¤åŠ è½½çš„æ˜¯æ­£ç¡®çš„ç›®å½•ï¼ˆç”Ÿäº§æ„å»ºæˆ–å¼€å‘æ„å»ºï¼‰
2. æŸ¥çœ‹ Chrome æ‰©å±•é”™è¯¯ä¿¡æ¯
3. æ‰“å¼€ DevTools æŸ¥çœ‹æ§åˆ¶å°é”™è¯¯
4. ç¡®è®¤ `manifest.json` æ­£ç¡®å¤åˆ¶åˆ°è¾“å‡ºç›®å½•

### Q4: ä¸ºä»€ä¹ˆæ„å»ºåä½“ç§¯åè€Œå˜å¤§äº†ï¼Ÿ

**A**:
- å¼€å‘æ¨¡å¼ï¼ˆ`npm run dev`ï¼‰ä¸å‹ç¼©ä»£ç ï¼Œä½“ç§¯ä¼šæ›´å¤§
- ç”Ÿäº§æ¨¡å¼ï¼ˆ`npm run build`ï¼‰æ‰ä¼šå‹ç¼©
- å¦‚æœç”Ÿäº§æ„å»ºä¹Ÿå˜å¤§ï¼Œæ£€æŸ¥æ˜¯å¦å¼•å…¥äº†æ–°çš„å¤§å‹ä¾èµ–

### Q5: å¦‚ä½•æŸ¥çœ‹æ„å»ºäº§ç‰©çš„ä¾èµ–å…³ç³»ï¼Ÿ

**A**:
```bash
# ç”Ÿäº§æ„å»ºåæŸ¥çœ‹ meta.json
cat dist/meta.json

# æˆ–ä½¿ç”¨åœ¨çº¿åˆ†æå·¥å…·
# https://esbuild.github.io/analyze/
# ä¸Šä¼  meta.json æ–‡ä»¶
```

---

## ğŸ“š ç›¸å…³èµ„æº

### å®˜æ–¹æ–‡æ¡£
- [esbuild å®˜æ–¹æ–‡æ¡£](https://esbuild.github.io/)
- [Chrome Extension å¼€å‘æ–‡æ¡£](https://developer.chrome.com/docs/extensions/)
- [Manifest V3 è¿ç§»æŒ‡å—](https://developer.chrome.com/docs/extensions/mv3/intro/)

### å·¥å…·æ¨è
- [esbuild Bundle Analyzer](https://esbuild.github.io/analyze/) - æ„å»ºåˆ†æ
- [Chrome Extension Source Viewer](https://chromewebstore.google.com/detail/chrome-extension-source-v/jifpbeccnghkjeaalbbjmodiffmgedin) - æŸ¥çœ‹å·²å®‰è£…æ‰©å±•æºç 

### ç¤¾åŒº
- [Chrome Extensions GitHub](https://github.com/GoogleChrome/chrome-extensions-samples)
- [esbuild GitHub](https://github.com/evanw/esbuild)

---

## ğŸ”„ ç‰ˆæœ¬å†å²

### v1.6.3 (2024-10-10)
- âœ¨ å¼•å…¥ esbuild æ„å»ºç³»ç»Ÿ
- âš¡ æ„å»ºé€Ÿåº¦æå‡ 66x
- ğŸ“¦ åŒ…ä½“ç§¯å‡å°‘ 70%
- ğŸ› ï¸ æ·»åŠ å¼€å‘æ¨¡å¼ï¼ˆWatchï¼‰
- ğŸ“Š æ·»åŠ æ„å»ºåˆ†ææŠ¥å‘Š

---

## ğŸ’¡ è´¡çŒ®æŒ‡å—

å¦‚æœä½ æƒ³æ”¹è¿›æ„å»ºé…ç½®ï¼Œè¯·ï¼š

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ï¼š`git checkout -b feature/build-improvement`
3. ä¿®æ”¹ `scripts/esbuild.config.js`
4. æµ‹è¯•æ„å»ºï¼š`npm run build` å’Œ `npm run dev`
5. æäº¤ PR

---

## ğŸ“ è®¸å¯è¯

GPL-3.0 License - è¯¦è§ LICENSE æ–‡ä»¶
